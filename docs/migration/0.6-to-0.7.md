# Migration Guide: 0.6.x to 0.7.0

This guide helps you upgrade from grafton-ndi 0.6.x to 0.7.0.

## Overview

Version 0.7.0 introduces significant API improvements:
- Builder patterns for all major types
- Renamed types to avoid confusion with Rust standard library
- Enhanced safety documentation
- Better validation and error handling

## Breaking Changes

### Type Renames

To avoid confusion with `std::marker::Send`, key types have been renamed:

```rust
// Before (0.6.x)
use grafton_ndi::{Send, Sender};
let sender = Sender { name: "Test".into(), ... };
let send = Send::new(&ndi, sender)?;

// After (0.7.0)
use grafton_ndi::{SendInstance, SendOptions};
let options = SendOptions::builder("Test")
    .clock_video(true)
    .build()?;
let send = SendInstance::new(&ndi, options)?;
```

### Builder Patterns

All frame types now use builders instead of struct literals:

```rust
// Before (0.6.x)
let frame = VideoFrame {
    xres: 1920,
    yres: 1080,
    fourcc: FourCCVideoType::BGRA,
    frame_rate_n: 60,
    frame_rate_d: 1,
    ..Default::default()
};

// After (0.7.0)
let frame = VideoFrame::builder()
    .resolution(1920, 1080)
    .fourcc(FourCCVideoType::BGRA)
    .frame_rate(60, 1)
    .build()?;
```

### Receiver Configuration

```rust
// Before (0.6.x)
let recv_opts = Receiver {
    source_to_connect_to: source,
    color_format: RecvColorFormat::RGBX_RGBA,
    bandwidth: RecvBandwidth::Highest,
    ..Default::default()
};
let recv = Recv::new(&ndi, recv_opts)?;

// After (0.7.0)
let recv = Receiver::builder(source)
    .color(RecvColorFormat::RGBX_RGBA)
    .bandwidth(RecvBandwidth::Highest)
    .build(&ndi)?;
```

### Error Handling

Builder methods now validate inputs:

```rust
// This now returns an error at build time
let options = SendOptions::builder("My Source")
    .clock_video(false)
    .clock_audio(false)
    .build()?; // Error: At least one clock must be enabled
```

## Step-by-Step Migration

1. **Update Imports**
   ```rust
   // Replace
   use grafton_ndi::{Send, Sender};
   // With
   use grafton_ndi::{SendInstance, SendOptions};
   ```

2. **Update Type Names**
   - `Send` → `SendInstance`
   - `Sender` → `SendOptions`
   - `Recv` → `Receiver` (method names)

3. **Convert to Builders**
   - Replace struct literals with builder calls
   - Use fluent API for configuration
   - Handle potential errors from `.build()`

4. **Review Thread Safety**
   - New version has comprehensive safety documentation
   - No behavioral changes, just better documented

## Common Patterns

### Creating a Sender
```rust
// Old
let sender = Sender {
    name: "My NDI Source".into(),
    groups: Some("Public".into()),
    clock_video: true,
    clock_audio: false,
};
let send = Send::new(&ndi, sender)?;

// New
let send = SendInstance::new(&ndi, 
    SendOptions::builder("My NDI Source")
        .groups("Public")
        .clock_video(true)
        .clock_audio(false)
        .build()?
)?;
```

### Creating Frames
```rust
// Old
let mut frame = VideoFrame::default();
frame.xres = 1920;
frame.yres = 1080;
frame.fourcc = FourCCVideoType::BGRA;

// New
let frame = VideoFrame::builder()
    .resolution(1920, 1080)
    .fourcc(FourCCVideoType::BGRA)
    .build()?;
```

## Benefits

- **Type Safety**: Builder validation catches errors at compile time
- **Clarity**: No confusion with `std::marker::Send`
- **Ergonomics**: Fluent API is easier to read and write
- **Future Proof**: Builders allow adding new options without breaking changes